@model SME.SR.Infra.BoletimEscolarDetalhadoCabecalhoDto
@using SME.SR.Infra;

@{

    int contadorQuebrarPagina = 0;
    int contadorMaximoLinhasPorPagina = 48;
    int contadorPagina = 0;

    string VerificaQuebra()
    {
        if (contadorQuebrarPagina >= contadorMaximoLinhasPorPagina)
        {
            contadorQuebrarPagina = 0;
            contadorPagina = contadorPagina + 1;

            //var str = MontarCabecalho();
            return $@"<div style='page-break-before:always' />";

        }
        return string.Empty;

    }

    string MontarCabecalho()
    {
        contadorQuebrarPagina = contadorQuebrarPagina + 8;
        var str = $@"<table class='cabecalho-principal'>
<tr>
<td width='10%'>
<img class='img-logo-sgp'
src='logoMono.png'
alt='Logo SGP' />
</td>
<td width='80%' style='padding-right: 10px'>
<div class='cabecalho-titulo-01'>BOLETIM ESCOLAR - 2021</div>
<div class='cabecalho-titulo-02'>
SECRETARIA MUNICIPAL DE EDUCAÇÃO
</div>
<div class='cabecalho-titulo-02'>
{ Model.NomeDre }
</div>
<div class='cabecalho-titulo-02'>{ Model.NomeUe }</div>
</td>";
        if (!string.IsNullOrEmpty(Model.Foto))
        {
            str += $@"<td width='10%'>
<img src='{ Model.Foto }' alt='Aluno' />
</td>";
        }


        str += $@"</tr>
</table>
<table class='cabecalho-relatorio margin-top'>
<tr>
<td width='50%'>Estudante: { Model.Aluno }</td>
<td width='50%'>Ciclo: { Model.Ciclo }</td>
</tr>
</table>
<table class='cabecalho-relatorio'>
<tr class='cabecalho-relatorio-sem-top'>
<td class='cabecalho-relatorio-sem-top'>Código EOL: { Model.CodigoEol }</td>
<td class='cabecalho-relatorio-sem-top'>Turma: { Model.NomeTurma}</td>
<td class='cabecalho-relatorio-sem-top'>Frequência Global: { Model.FrequenciaGlobal }</td>
</tr>
</table>";

        return str;
    }

    string ComponentesCurriculares(List<AreaConhecimentoComponenteCurricularDto> areasConhecimento, ComponenteCurricularRegenciaDto componenteCurricularRegencia)
    {
        bool exibeLegendaConceito = false;
        bool exibeLegendaSintese = false;

        var str = @"<table class='tabela margin-top'>
<tr class='titulo'>
<td rowspan='2' class='sem-borda-bottom'>Componentes curriculares</td>
<td colspan='2' class='centro-bimestre'>1° Bim.</td>
<td colspan='2' class='centro-bimestre'>2° Bim.</td>
<td colspan='2' class='centro-bimestre'>3° Bim.</td>
<td colspan='2' class='centro-bimestre'>4° Bim.</td>
<td colspan='2' class='centro-bimestre'>Final</td>
</tr>
<tr class='titulo'>
<td class='centro-titulo sem-borda-bottom'>Nota</td>
<td class='centro-titulo sem-borda-bottom'>%</td>
<td class='centro-titulo sem-borda-bottom'>Nota</td>
<td class='centro-titulo sem-borda-bottom'>%</td>
<td class='centro-titulo sem-borda-bottom'>Nota</td>
<td class='centro-titulo sem-borda-bottom'>%</td>
<td class='centro-titulo sem-borda-bottom'>Nota</td>
<td class='centro-titulo sem-borda-bottom'>%</td>
<td class='centro-titulo sem-borda-bottom'>Nota</td>
<td class='centro-titulo sem-borda-bottom'>%</td>
</tr>";
        str += "</table>";

        if (componenteCurricularRegencia != null)
        {
            str += "<table class='tabela'>";
            foreach (var componente in componenteCurricularRegencia.ComponentesCurriculares)
            {
                if (!componente.Nota)
                    exibeLegendaSintese = true;

                if (!string.IsNullOrEmpty(componente.NotaBimestre1) && (componente.NotaBimestre1.Contains("P") || componente.NotaBimestre1.Contains("S")))
                    exibeLegendaConceito = true;

                str += $@"<tr class='corpo'>
    <td class='valor-titulo'>{componente.Nome}</td>
    <td class='centro-valor'>{componente.NotaBimestre1}</td>
    <td class='centro-valor'>{componenteCurricularRegencia.FrequenciaBimestre1}</td>
    <td class='centro-valor'>{componente.NotaBimestre2}</td>
    <td class='centro-valor'>{componenteCurricularRegencia.FrequenciaBimestre2}</td>
    <td class='centro-valor'>{componente.NotaBimestre3}</td>
    <td class='centro-valor'>{componenteCurricularRegencia.FrequenciaBimestre3}</td>
    <td class='centro-valor'>{componente.NotaBimestre4}</td>
    <td class='centro-valor'>{componenteCurricularRegencia.FrequenciaBimestre4}</td>
    <td class='centro-valor'>{componente.NotaFinal}</td>
    <td class='centro-valor'>{componenteCurricularRegencia.FrequenciaFinal}</td>
    </tr>";
            }
            str += "</table>";
        }

        for (var i = 0; i < areasConhecimento.Count; i++)
        {
            if (i == 0 && componenteCurricularRegencia != null)
            {
                str += "<table class='tabela margin-top'>";
            }
            else if (i > 0)
            {
                str += "<table class='tabela margin-top'>";
            }
            else
            {
                str += "<table class='tabela'>";
            }
            foreach (var componenteCurricular in areasConhecimento[i].ComponentesCurriculares)
            {
                if (!componenteCurricular.Nota)
                    exibeLegendaSintese = true;

                if (!string.IsNullOrEmpty(componenteCurricular.NotaBimestre1) && (componenteCurricular.NotaBimestre1.Contains("P") || componenteCurricular.NotaBimestre1.Contains("S")))
                    exibeLegendaConceito = true;

                str += $@"<tr class='corpo'>
    <td class='valor-titulo'>{componenteCurricular.Nome}</td>
    <td class='centro-valor'>{componenteCurricular.NotaBimestre1}</td>
    <td class='centro-valor'>{componenteCurricular.FrequenciaBimestre1}</td>
    <td class='centro-valor'>{componenteCurricular.NotaBimestre2}</td>
    <td class='centro-valor'>{componenteCurricular.FrequenciaBimestre2}</td>
    <td class='centro-valor'>{componenteCurricular.NotaBimestre3}</td>
    <td class='centro-valor'>{componenteCurricular.FrequenciaBimestre3}</td>
    <td class='centro-valor'>{componenteCurricular.NotaBimestre4}</td>
    <td class='centro-valor'>{componenteCurricular.FrequenciaBimestre4}</td>
    <td class='centro-valor'>{componenteCurricular.NotaFinal}</td>
    <td class='centro-valor'>{componenteCurricular.FrequenciaFinal}</td>
    </tr>";
            }
            str += "</table>";

        }

        if(exibeLegendaSintese || exibeLegendaConceito)
        {
            str += "<p>Legenda: F:Faltante - NF:Não Faltante - P:Plenamente Satisfatório - S:Satisfatório - NS:Não Satisfatório</p>";
        }

        return str;
    }

    string ParecerConclusivo(string parecer)
    {
        var str = $@"<table class='tabela margin-top'>
<tr class='titulo'>
<td>Parecer Conclusivo: {parecer}</td>
</tr>
</table>";

        return !string.IsNullOrEmpty(parecer) ? str : null;
    }

    string RecomendacoesEstudante(string recomendacoes)
    {
        var str = $@"<table class='tabela margin-top'>
<tr class='titulo'>
<td>Recomendações ao estudante</td>
</tr>
<tr>
<td>
    {recomendacoes}
</td>
</tr>
</table>";

        return !string.IsNullOrEmpty(recomendacoes) ? str : null;
    }

    string RecomendacoesFamilia(string recomendacoes)
    {
        var str = $@"<table class='tabela margin-top'>
<tr class='titulo'>
<td>Recomendações a família</td>
</tr>
<tr>
<td>
    {recomendacoes}
</td>
</tr>
</table>";

        return !string.IsNullOrEmpty(recomendacoes) ? str : null;
    }

    string Anotacoes()
    {
        var str = @"<table class='tabela-final margin-top'>
<tr>
<td width='100%' style='border-bottom: 1px solid #42474a;'>
    &nbsp
</td>
</tr>
<tr>
<td width='100%' style='border-bottom: 1px solid #42474a;'>
    &nbsp
</td>
</tr>
</table>";

        return str;
    }

}

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RELATÓRIO BOLETIM ESCOLAR DETALHADO</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap"
          rel="stylesheet" />
    <link rel="stylesheet"
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
          crossorigin="anonymous" />
</head>
<body class="body-relatorio">
    <style>
        .body-relatorio {
            margin: 0.5cm auto;
            font-family: "Roboto Mono", monospace;
            width: 21cm;
            min-height: 29.7cm;
            background: white;
            color: #42474a;
        }

        .img-logo-sgp {
            height: 64px;
            float: left;
        }

        /* CABEÇALHO */
        .cabecalho-principal {
        }

            .cabecalho-principal .cabecalho-titulo-01 {
                text-align: right;
                font-size: 14px;
                font-weight: bold;
            }

            .cabecalho-principal .cabecalho-titulo-02 {
                text-align: right;
                font-size: 14px;
            }

        .cabecalho-relatorio {
            display: table;
            width: 100%;
            font-size: 16px;
            border: 1px solid #42474a;
        }

            .cabecalho-relatorio tr td {
                border: 1px solid #42474a;
                padding-left: 10px;
            }

            .cabecalho-relatorio .cabecalho-relatorio-sem-top {
                border-top: 1px solid #fff;
            }

        .margin-top {
            margin-top: 10px;
        }

        .tabela {
            width: 100%;
            font-size: 14px;
            border: 1px solid #42474a;
        }

            .tabela tr td {
                border: 1px solid #42474a;
                padding-left: 10px;
            }

            .tabela .titulo {
                background-color: #f3f3f3;
            }
                .tabela .titulo .componente {
                    width: 350px;
                }

                .tabela .titulo .centro-bimestre {
                    background-color: #f3f3f3;
                    text-align: center;
                    width: 90px;
                }

                .tabela .titulo .centro-bimestre-eja {
                    background-color: #f3f3f3;
                    text-align: center;
                    width: 180px;
                }

                .tabela .titulo .centro-titulo {
                    background-color: #f3f3f3;
                    text-align: center;
                    padding-left: 5px;
                    padding-right: 5px;
                    width: 45px;
                }

                .tabela .titulo .centro-titulo-eja {
                    background-color: #f3f3f3;
                    text-align: center;
                    padding-left: 5px;
                    padding-right: 5px;
                    width: 90px;
                }

                .tabela .titulo .sem-borda-bottom {
                    border-bottom: 1px solid #fff;
                }

            .tabela .corpo .centro-valor {
                text-align: center;
                padding-left: 3px;
                padding-right: 3px;
                width: 45px;
                font-size: 10px;
            }

            .tabela .corpo .centro-valor-eja {
                text-align: center;
                padding-left: 3px;
                padding-right: 3px;
                width: 90px;
                font-size: 10px;
            }

            .tabela .corpo .valor-titulo {
                width: 350px;
                font-size: 12px;
            }

        .tabela-final {
            width: 100%;
            font-size: 14px;
            border-bottom: 1px solid #42474a;
        }

            .tabela-final tr td {
                border-bottom: 1px solid #42474a;
                padding-left: 10px;
            }
    </style>

    @Html.Raw(MontarCabecalho())
    #CONTEUDO_ALUNO

</body>
</html>
