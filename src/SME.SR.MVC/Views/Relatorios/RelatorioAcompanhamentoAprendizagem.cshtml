@model SME.SR.Infra.RelatorioAcompanhamentoAprendizagemDto

@{
    int paginaAtual = 0;
    int contadorQuebrarPagina = 0;
    int contadorMaximoLinhasPorPagina = 46;

    Microsoft.AspNetCore.Html.IHtmlContent MontarComponente(string componenteNome, bool removerBorderTop = false)
    {
        // Contar
        contadorQuebrarPagina = contadorQuebrarPagina + 2;
        var stiloBorderTop = removerBorderTop ? "border-top: none;" : "";
        var str = $@"<table class='tabela-alunos'>
<tbody>
<tr>
<td style='border-bottom: none;{stiloBorderTop}'></td>
</tr>
</tbody>
</table>
<table class='tabela-alunos'>
<thead>
<tr><th>{componenteNome}</th></tr>
</thead>
</table>";
        return Html.Raw(str);
    }

    Microsoft.AspNetCore.Html.IHtmlContent MontarQuebrarPagina()
    {
        paginaAtual++;
        var str = $@"<footer class='rodape-rel-faltas-frequencia'>
<div class='titulo-sgp-rodape'>
SGP - SISTEMA DE GESTÃO PEDAGÓGICA | FALTAS
</div>
</footer>
<div style='page-break-before:always' />";
        return Html.Raw(str);
    }

    Microsoft.AspNetCore.Html.IHtmlContent MontarCabecalho(string dre, string ue, string turma, string professores, string semestre)
    {
        var str =
           $@"<div>
<img class='img-logo-sgp' src='logoMono.png' alt='Logo SGP' />
</div>
<div class='titulo-sgp'>SGP - SISTEMA DE GESTÃO PEDAGÓGICA</div>
<div class='titulo-relatorio'>RELATÓRIO DO ACOMPANHAMENTO DA APRENDIZAGEM</div>
<div class='titulo-sub-relatorio'>{semestre}</div>
<div class='fonte-14 header-pagina'>
<table>
<tbody>
<tr>
<td class='campo-dre'>DRE: {dre}</td>
<td class='campo-ue'>UE: {ue}</td>
</tr>
</tbody>
</table>
<table>
<tbody>
<tr>
<td class='campo-bimestre'>TURMA: {turma}</td>
<td class='campo-componente-curricular'>
PROFESSORES: {professores}
</td>
</tr>
</tbody>
</table>
</div>
";

        return Html.Raw(str);
    }

    string EspacoEmBranco()
    {
        return @"<table><tbody><tr><td height='22px' width='100%' class='tabela-cabecalho sem-border-bottom sem-border-top'> </td></tr></tbody></table>";
    }
}

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Relatório Faltas e Frequência</title>
</head>
<body class="body-rel-faltas-frequencia">
    <style>
        .body-rel-faltas-frequencia {
            margin: 0.5cm auto;
            font-family: Roboto, sans-serif;
            width: 21cm;
            min-height: 29.7cm;
            background: white;
            color: #42474a;
        }

        .titulo-sgp {
            text-align: right;
            font-size: 14px;
            font-weight: bold;
        }

        .titulo-relatorio {
            text-align: right;
            font-size: 14.5px;
            margin-top: 7px;
        }

        .titulo-sub-relatorio {
            text-align: right;
            font-size: 12.5px;
            margin-top: 7px;
        }

        .img-logo-sgp {
            height: 64px;
            float: left;
        }

        .header-pagina {
            margin-top: 33px;
            margin-bottom: 22px;
        }

            .header-pagina td {
                text-align: left;
            }

        .campo-dre {
            width: 25%;
        }

        .campo-ue {
            width: 60%
        }

        .campo-ano {
            width: 15%
        }

        .campo-bimestre {
            width: 20%;
            border-top: none;
        }

        .campo-componente-curricular {
            width: 80%;
            border-top: none;
        }

        .campo-usuario {
            width: 60%;
            border-top: none;
        }

        .campo-rf-data {
            width: 20%;
            border-top: none;
        }

        table {
            display: table;
            width: 100%;
            border-color: #42474a;
            empty-cells: show;
            border: none;
            border-collapse: collapse;
        }

        thead {
            background-color: #f3f3f3;
        }

        th {
            border: 1px solid #42474a;
            font-weight: normal;
        }

        td {
            border: 1px solid #42474a;
            text-align: center;
        }

        .tabela-alunos tr {
            font-size: 12px;
            height: 24px;
        }

        .mt-25 {
            margin-top: 25px;
        }

        .fonte-14 {
            font-size: 14px !important;
        }

        .alinhar-esquerda {
            text-align: left;
        }

        .rodape-rel-faltas-frequencia {
            margin-top: 10px;
            font-size: 9px;
            font-weight: bold;
        }

        .titulo-sgp-rodape {
            float: left;
        }

        .contador-pagina {
            float: right;
            font-size: 15px;
        }

        .sem-border-bottom {
            border-bottom: 0;
        }

        .sem-border-top {
            border-bottom: 0;
        }

        .somente-border-top {
            border-bottom: 0;
            border-left: 0;
            border-right: 0;
        }
    </style>


    <div>
        @{
            @MontarCabecalho(Model.Cabecalho.Dre, Model.Cabecalho.Ue, Model.Cabecalho.Turma, Model.Cabecalho.Professores, Model.Cabecalho.Semestre)

            foreach (var aluno in Model.Alunos)
            {
                <table class='tabela-alunos'>
                    <thead>
                        <tr>
                            <td width='100%' class='centralizar sem-border-bottom negrito'>@aluno.Nome</td>
                        </tr>
                    </thead>
                </table>
                <table class='tabela-alunos'>
                    <thead>
                        <tr>
                            <td class='centralizar sem-border-bottom negrito'>DATA NASCIMENTO</td>
                            <td class='centralizar sem-border-bottom negrito'>CÓDIGO EOL</td>
                            <td class='centralizar sem-border-bottom negrito'>SITUAÇÃO</td>
                            <td class='centralizar sem-border-bottom negrito'>RESPONSÁVEL</td>
                            <td class='centralizar sem-border-bottom negrito'>TELEFONE</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td width="20%" class='centralizar sem-border-bottom'>@aluno.DataNascimento</td>
                            <td width="14%" class='centralizar sem-border-bottom'>@aluno.CodigoEol</td>
                            <td width="22%" class='centralizar sem-border-bottom'>@aluno.Situacao</td>
                            <td width="22%" class='centralizar sem-border-bottom'>@aluno.Responsavel</td>
                            <td width="22%" class='centralizar sem-border-bottom'>@aluno.Telefone</td>
                        </tr>
                    </tbody>
                </table>

                @Html.Raw(EspacoEmBranco())

                @if (aluno.Fotos.Any())
                {
                    <table class='tabela-alunos'>
                        <thead>
                            <tr>
                                <td width='100%' class='centralizar sem-border-bottom negrito'>FOTOS</td>
                            </tr>
                        </thead>
                    </table>
                    <table class='tabela-alunos sem-border-bottom'>
                        <tbody>
                            <tr>
                                <td width="33%" class='centralizar sem-border-bottom'>
                                    <img style="margin:3px" src="@aluno.Fotos.ElementAt(0).Caminho" height="180px" />
                                </td>
                                <td width="33%" class='centralizar sem-border-bottom'>
                                    @if (aluno.Fotos.ElementAtOrDefault(1) != null)
                                    {
                                        <img style="margin:3px" src="@aluno.Fotos.ElementAt(1).Caminho" height="180px" />
                                    }
                                </td>
                                <td width="33%" class='centralizar sem-border-bottom'>
                                    @if (aluno.Fotos.ElementAtOrDefault(2) != null)
                                    {
                                        <img style="margin:3px" src="@aluno.Fotos.ElementAt(2).Caminho" height="180px" />
                                    }
                                </td>
                            </tr>
                        </tbody>
                    </table>
                }

                <table class='tabela-alunos sem-border-top'>
                    <thead>
                        <tr>
                            <td width='100%' class='centralizar negrito'>REGISTRO DO PERCURSO DA TURMA</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="centralizar sem-border-bottom">
                                <div style="margin:10px">
                                    @aluno.RegistroPercursoTurma
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>

                @Html.Raw(EspacoEmBranco())

                <table class='tabela-alunos'>
                    <thead>
                        <tr>
                            <td width='100%' class='centralizar sem-border-bottom negrito'>FREQUÊNCIA</td>
                        </tr>
                    </thead>
                </table>
                <table class='tabela-alunos'>
                    <thead>
                        <tr>
                            <td class='centralizar sem-border-bottom negrito'>BIMESTRE</td>
                            <td class='centralizar sem-border-bottom negrito'>AULAS</td>
                            <td class='centralizar sem-border-bottom negrito'>AUSÊNCIAS</td>
                            <td class='centralizar sem-border-bottom negrito'>FREQUÊNCIA</td>
                        </tr>
                    </thead>
                    <tbody>

                        @foreach (var frequencia in aluno.Frequencias)
                        {
                            <tr>

                                <td width="25%" class='centralizar sem-border-bottom'>@frequencia.Bimestre</td>
                                <td width="25%" class='centralizar sem-border-bottom'>@frequencia.Aulas</td>
                                <td width="25%" class='centralizar sem-border-bottom'>@frequencia.Ausencias</td>
                                <td width="25%" class='centralizar sem-border-bottom'>@frequencia.Frequencia</td>
                            </tr>

                        }

                    </tbody>
                </table>

                <table class='tabela-alunos'>
                    <thead>
                        <tr>
                            <td width='100%' class='centralizar sem-border-bottom negrito'>REGISTRO INDIVIDUAL</td>
                        </tr>
                    </thead>
                </table>
                <table class='tabela-alunos'>
                    <thead>
                        <tr>
                            <td class='centralizar sem-border-bottom negrito'>DATA DO REGISTRO</td>
                            <td class='centralizar sem-border-bottom negrito'>REGISTRO</td>

                        </tr>
                    </thead>
                    <tbody>

                        @foreach (var registroIndividual in aluno.RegistrosIndividuais)
                        {
                            <tr>

                                <td width="15%" class='centralizar sem-border-bottom'>@registroIndividual.Data</td>
                                <td width="85%" class='centralizar sem-border-bottom'>@registroIndividual.Descricao</td>
                            </tr>

                        }

                    </tbody>
                </table>

                @Html.Raw(EspacoEmBranco())

                <table class='tabela-alunos sem-border-top'>
                    <thead>
                        <tr>
                            <td width='100%' class='centralizar negrito'>OBSERVAÇÕES</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="centralizar sem-border-bottom">
                                <div style="margin:10px">
                                    @aluno.Observacoes
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>

                @Html.Raw(EspacoEmBranco())

                <table class='tabela-alunos'>
                    <thead>
                        <tr>
                            <td width='100%' class='centralizar sem-border-bottom negrito'>OCORRÊNCIAS</td>
                        </tr>
                    </thead>
                </table>
                <table class='tabela-alunos'>
                    <thead>
                        <tr>
                            <td class='centralizar sem-border-bottom negrito'>DATA DO OCORRÊNCIA</td>
                            <td class='centralizar sem-border-bottom negrito'>TIPO</td>
                            <td class='centralizar sem-border-bottom negrito'>DESCRIÇÃO DA OCORRÊNCIA</td>

                        </tr>
                    </thead>
                    <tbody>

                        @foreach (var ocorrencia in aluno.Ocorrencias)
                        {
                            <tr>

                                <td width="15%" class='centralizar sem-border-bottom'>@ocorrencia.Data</td>
                                <td width="15%" class='centralizar sem-border-bottom'>@ocorrencia.Tipo</td>
                                <td width="70%" class='centralizar sem-border-bottom'>
                                    <table width="100%" style="border:0; margin:0; border-collapse:initial">
                                        <tr>
                                            <td style="border:0">
                                                @ocorrencia.Titulo
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="border-bottom:0; border-right:0;border-left:0">
                                                @ocorrencia.Descricao
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>

                        }

                    </tbody>
                </table>
                <table class='tabela-cabecalho'>
                    <tr>
                        <td width='100%' class='somente-border-top'> </td>
                    </tr>                    
                </table>

            }
        }
    </div>
</body>
</html>